jQuery(document).ready(function(Q){var ae=Q(window),j=Q(document),G=Q("body"),C=Q("#mailster_iframe"),Y=Q("#template-wrap"),ac,r,B=Q("#mailster_template .inside"),f=!!Q("#mailster_disabled").val(),V=Q("#title"),N=Q("#mailster_subject"),aa=Q("#mailster_preheader"),X=Q("#content"),b=Q("#excerpt"),ab=Q("#modules"),ad=Q("#plain-text-wrap"),M=Q("#html-wrap"),t=Q("#head"),x=Q("#optionbar"),I=[],W=Q("#post_ID").val(),an=0,c=Q("#clickmap-stats"),U=Q('[name^="mailster_data"]'),F=Q("#mailster_nonce").val(),H=false,ai,E,s,J,h,m,L,af=Q("html,body"),g="WebkitAppearance" in document.documentElement.style,l=(/firefox/i).test(navigator.userAgent),k=(/msie|trident/i).test(navigator.userAgent),z,p,ak=false,y="ontouchstart" in document.documentElement,o=typeof tinymce=="object",O,D={mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true};function aj(){a("disable");ag();r=(C[0].contentWindow||C[0].contentDocument);if(r.document){r=r.document}Z();var aq=setTimeout(function(){if(!H){C.trigger("load")}},5000);window.Mailster=window.Mailster||{refresh:function(){a("refresh")},save:function(){a("save")},trigger:a,autosave:""};C.on("load",function(){if(H){return false}if(!f){if(!h){h=new ah()}if(!L){L=new ap()}if(!J){J=new ao()}window.Mailster.editbar=L}else{}a("enable");H=true;clearInterval(aq);ac=C.contents().find("body");if(f){window.autosave=wp.autosave=function(){return true};window.onbeforeunload=null;ac.on("click","a",function(){window.open(this.href);return false})}else{}a("resize");a("refresh");if(!X.val()){a("save")}Q("#normal-sortables").on("sortupdate",function(ar,at){a("resize")});Y.removeClass("load");I.push(A())});ae.on("resize.mailster",function(){a("refresh")});if(/post_status=autoresponder/.test(Q("#referredby").val())||/post_status=autoresponder/.test(location.search)){Q("#mailster_delivery").find('a[href="#autoresponder"]').click()}if(k){G.addClass("ie")}if(y){G.addClass("touch")}}function Z(){j.on("click","a.external",function(){window.open(this.href);return false}).on("change","input[name=screen_columns]",function(){a("resize")});Q("#mailster_submitdiv").on("change","#use_pwd",function(){Q("#password-wrap").slideToggle(200).find("input").focus().select();Q("#post_password").prop("disabled",!Q(this).is(":checked"))});if(!f){j.on("heartbeat-send",function(ar,aq){if(aq&&aq.wp_autosave){aq.wp_autosave["content"]=i();aq.wp_autosave["excerpt"]=b.val();aq.mailsterdata=U.serialize()}}).on("click",".restore-backup",function(ar,aq){var aq=wp.autosave.local.getSavedPostData();T(aq.content);V.val(aq.post_title);a("refresh");return false}).on("load",".mailster-preview-iframe",function(){var aw=Q(this),av=aw.contents(),ar=av.find("body");if(aw.is(".mobile")){var at=av.find("style").text(),aq=/@media/.test(at);if(aq){var au=0.85;ar.css({zoom:au,"-moz-transform":"scale("+au+")","-moz-transform-origin":"0 0",transform:"scale("+au+")","transform-origin":"0 0"})}}ar.on("click","a",function(){var ax=Q(this).attr("href");if(ax&&ax!="#"){window.open(ax)}return false})}).on("change",".dynamic_embed_options_taxonomy",function(){var aq=Q(this),ar=aq.val();aq.parent().find(".button").remove();if(ar!=-1){if(aq.parent().find("select").length<aq.find("option").length-1){Q(' <a class="button button-small add_embed_options_taxonomy">'+mailsterL10n.add+"</a>").insertAfter(aq)}}else{aq.parent().html("").append(aq)}return false}).on("click",".add_embed_options_taxonomy",function(){var ar=Q(this),aq=ar.prev().clone();aq.insertBefore(ar).val("-1");Q("<span> "+mailsterL10n.or+" </span>").insertBefore(aq);ar.remove();return false});V.on("change",function(){if(!N.val()){N.val(Q(this).val())}});Q("#mailster_submitdiv").on("#post","submit",function(){if(ak){return false}a("save")}).on("click",".sendnow-button",function(){if(!confirm(mailsterL10n.send_now)){return false}});Q("#mailster_delivery").on("change","input.timezone",function(){Q(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){Q(".autoresponderfield-mailster_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){var aq=Q(this).parent().parent().parent();aq.find("span")._Class("disabled")}).on("change","#autoresponder-post_type",function(){var aq=Q("#autoresponder-taxonomies");aq.find("select").prop("disabled",true);R("get_post_term_dropdown",{labels:false,names:true,posttype:Q(this).val()},function(ar){if(ar.success){aq.html(ar.html)}},function(ar,au,at){loader(false)})}).on("click",".category-tabs a",function(){var ar=Q(this),aq=ar.attr("href");Q("#mailster_delivery").find(".tabs-panel").hide();Q("#mailster_delivery").find(".tabs").removeClass("tabs");ar.parent().addClass("tabs");Q(aq).show();Q("#mailster_is_autoresponder").val((aq=="#autoresponder")?1:"");return false}).on("click",".mailster_sendtest",function(){var ar=Q(this),aq=Q("#delivery-ajax-loading").css("display","inline");ar.prop("disabled",true);a("save");R("send_test",{formdata:Q("#post").serialize(),to:Q("#mailster_testmail").val(),content:X.val(),head:t.val(),plaintext:b.val()},function(at){aq.hide();ar.prop("disabled",false);var au=Q('<div class="'+((!at.success)?"error":"updated")+'"><p>'+at.msg+"</p></div>").hide().prependTo(ar.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){au.remove()})},function(at,aw,au){aq.hide();ar.prop("disabled",false);var av=Q('<div class="error"><p>'+aw+" "+at.status+": "+au+"</p></div>").hide().prependTo(ar.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){av.remove()})})}).on("change","#mailster_data_active",function(){(Q(this).is(":checked"))?Q(".active_wrap").addClass("disabled"):Q(".active_wrap").removeClass("disabled");Q(".deliverydate, .deliverytime").prop("disabled",!Q(this).is(":checked"))}).on("change","#mailster_data_autoresponder_active",function(){(Q(this).is(":checked"))?Q(".autoresponder_active_wrap").addClass("disabled"):Q(".autoresponder_active_wrap").removeClass("disabled")}).on("click",".mailster_spamscore",function(){var av=Q(this),aq=Q("#delivery-ajax-loading").css("display","inline"),au=Q("#spam_score_progress").removeClass("spam-score").slideDown(200),at=au.find(".bar");av.prop("disabled",true);Q(".score").html("");a("save");at.css("width","20%");R("send_test",{spamtest:true,formdata:Q("#post").serialize(),to:Q("#mailster_testmail").val(),content:X.val(),head:t.val(),plaintext:b.val()},function(aw){if(aw.success){at.css("width","40%");ar(aw.id,1)}else{aq.hide();au.slideUp(200);var ax=Q('<div class="error"><p>'+aw.msg+"</p></div>").hide().prependTo(av.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ax.remove()})}},function(aw,az,ax){aq.hide();av.prop("disabled",false);var ay=Q('<div class="error"><p>'+az+" "+aw.status+": "+ax+"</p></div>").hide().prependTo(av.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ay.remove()})});function ar(ax,aw){R("check_spam_score",{ID:ax},function(az){if(az.score){aq.hide();av.prop("disabled",false);au.addClass("spam-score");at.css("width",(parseFloat(az.score)*10)+"%");Q(".score").html("<strong>"+w(mailsterL10n.yourscore,az.score)+"</strong>:<br>"+mailsterL10n.yourscores[Math.floor((az.score/10)*mailsterL10n.yourscores.length)])}else{if(aw<=5&&!az.abort){var ay=(aw*10)+50;at.css("width",(ay)+"%");setTimeout(function(){ar(ax,++aw)},aw*400)}else{aq.hide();av.prop("disabled",false);at.css("width","100%");au.slideUp(200);var aA=Q('<div class="error"><p>'+az.msg+"</p></div>").hide().prependTo(av.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aA.remove();at.css("width",0)})}}},function(ay,aB,az){aq.hide();av.prop("disabled",false);var aA=Q('<div class="error"><p>'+aB+" "+ay.status+": "+az+"</p></div>").hide().prependTo(av.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aA.remove()})})}}).on("blur","input.deliverytime",function(){j.unbind(".mailster_deliverytime")}).on("focus, click","input.deliverytime",function(av){var aw=Q(this),ar=Q(this)[0],aq=aw.offset().left,ax=0,au=0,at=2;if(av.clientX-aq>23){ax=1,au=3,at=5}j.unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(ay){if(ay.keyCode==9){return(ax=!ax)?!p(ar,3,5):(ay.shiftKey)?!p(ar,0,2):true}}).on("keyup.mailster_deliverytime",function(ay){if(aw.val().length==1){aw.val(aw.val()+":00");p(ar,1,1)}if(document.activeElement.selectionStart==2){if(aw.val().substr(0,2)>23){aw.trigger("change");return false}p(ar,3,5)}});p(ar,au,at)}).on("change","input.deliverytime",function(){var ar=Q(this),at=ar.val(),aq;ar.addClass("inactive");if(!/^\d+:\d+$/.test(at)){if(at.length==1){at="0"+at+":00"}else{if(at.length==2){at=at+":00"}else{if(at.length==3){at=at.substr(0,2)+":"+at.substr(2,3)+"0"}else{if(at.length==4){at=at.substr(0,2)+":"+at.substr(2,4)}}}}}aq=at.split(":");if(!/\d\d:\d\d$/.test(at)&&at!=""||aq[0]>23||aq[1]>59){ar.val("00:00").focus();p(ar[0],0,2)}else{ar.val(at)}}).on("change","#mailster_autoresponder_action",function(){Q("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+Q(this).val())}).on("change","#time_extra",function(){Q("#autoresponderfield-mailster_timebased_advanced").slideToggle()}).on("click",".mailster_autoresponder_timebased-end-schedule",function(){(Q(this).is(":checked"))?Q(".mailster_autoresponder_timebased-end-schedule-field").slideDown():Q(".mailster_autoresponder_timebased-end-schedule-field").slideUp()}).on("change",".mailster-action-hooks",function(){var aq=Q(this).val();Q(".mailster-action-hook").val(aq);if(!aq){Q(".mailster-action-hook").focus()}}).on("change",".mailster-action-hook",function(){var aq=Q(this).val();if(!Q(".mailster-action-hooks option[value='"+aq+"']").length){Q(".mailster-action-hooks").append("<option>"+aq+"</option>")}Q(".mailster-action-hooks").val(aq)}).on("click",".mailster-total",function(){a("updateCount")}).on("change","#list_extra",function(){if(Q(this).is(":checked")){Q("#mailster_list_advanced").slideDown()}else{Q("#mailster_list_advanced").slideUp()}Q("#list-checkboxes").find("input.list").eq(0).trigger("change")}).on("focus","input.datepicker",function(){Q(this).removeClass("inactive").trigger("click")}).on("blur","input.datepicker",function(){Q(".deliverydate").html(Q(this).val());Q(this).addClass("inactive")}).on("change","input.datepicker",function(){});Q("#mailster_details").on("click",".default-value",function(){var aq=Q(this);Q("#"+aq.data("for")).val(aq.data("value"))});Q("input.color").wpColorPicker({color:true,width:250,mode:"hsl",palettes:Q(".colors").data("original-colors"),change:function(aq,ar){Q(this).val(ar.color.toString()).trigger("change")},clear:function(aq,ar){}});if(typeof jQuery.datepicker=="object"){Q("#mailster_delivery").find("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(),firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn",onClose:function(){var aq=Q(this).datepicker("getDate");Q(".deliverydate").html(Q(this).val())}});Q("input.datepicker.nolimit").datepicker("option","minDate",null)}else{Q("#mailster_delivery").find("input.datepicker").prop("readonly",false)}Q("#mailster_attachments").on("click",".delete-attachment",function(aq){aq.preventDefault();Q(this).parent().remove()}).on("click",".add-attachment",function(aq){aq.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:mailsterL10n.add_attachment,button:{text:mailsterL10n.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var at=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),ar=Q(".mailster-attachment").eq(0).clone();ar.find("img").attr("src",at.icon);ar.find(".mailster-attachment-label").html(at.filename);ar.find("input").attr("name","mailster_data[attachments][]").val(at.id);ar.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});Q("#mailster_receivers").on("change","input.list",function(){a("updateCount")}).on("change","#all_lists",function(){Q("#list-checkboxes").find("input.list").prop("checked",Q(this).is(":checked"));a("updateCount")}).on("change","#ignore_lists",function(){var aq=Q(this).is(":checked");Q("#list-checkboxes").each(function(){(aq)?Q(this).slideUp(200):Q(this).slideDown(200)}).find("input.list");a("updateCount")}).on("click",".edit-conditions",function(){tb_show(mailsterL10n.edit_conditions,"#TB_inline?x=1&width=720&height=520&inlineId=receivers-dialog",null);return false}).on("click",".remove-conditions",function(){if(confirm(mailsterL10n.remove_conditions)){Q("#receivers-dialog").find(".mailster-conditions").empty();a("updateCount")}return false}).on("click",".mailster-total",function(){a("updateCount")});Q(".close-conditions").on("click",tb_remove);Q("#mailster_options").on("click",".wp-color-result",function(){Q(this).closest("li.mailster-color").addClass("open")}).on("click","a.default-value",function(){var ar=Q(this).prev().find("input"),aq=ar.data("default");ar.wpColorPicker("color",aq);return false}).on("click","ul.colorschema",function(){var ar=Q("#mailster_options").find("input.color"),aq=Q(this).find("li.colorschema-field");a("disable");Q.each(aq,function(au){var at=aq.eq(au).data("hex");ar.eq(au).wpColorPicker("color",at)});a("enable")}).on("click","a.savecolorschema",function(){var ar=Q.map(Q("#mailster_options").find(".color"),function(at){return Q(at).val()});var aq=Q("#colorschema-ajax-loading").css("display","inline");R("save_color_schema",{template:Q("#mailster_template_name").val(),colors:ar},function(at){aq.hide();if(at.success){Q(".colorschema").last().after(Q(at.html).hide().fadeIn())}},function(at,av,au){aq.hide()})}).on("click",".colorschema-delete",function(){if(confirm(mailsterL10n.delete_colorschema)){var ar=Q(this).parent().parent();var aq=Q("#colorschema-ajax-loading").css({display:"inline"});R("delete_color_schema",{template:Q("#mailster_template_name").val(),hash:ar.data("hash")},function(at){aq.hide();if(at.success){ar.fadeOut(100,function(){ar.remove()})}},function(at,av,au){aq.hide()})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(mailsterL10n.delete_colorschema_all)){var ar=Q(".colorschema.custom");var aq=Q("#colorschema-ajax-loading").css({display:"inline"});R("delete_color_schema_all",{template:Q("#mailster_template_name").val()},function(at){aq.hide();if(at.success){ar.fadeOut(100,function(){ar.remove()})}},function(at,av,au){aq.hide()})}return false}).on("change","#mailster_version",function(){var aq=Q(this).val();K(aq)}).on("change","input.color",function(){var ar=Q(this);var aq=ar.data("value");P(aq,ar.val(),ar)});Q("#mailster_template").on("click","a.getplaintext",function(){var aq=b.val();b.val(mailsterL10n.loading);R("get_plaintext",{html:i()},function(ar){b.val(ar)},function(ar,au,at){b.val(aq)},"HTML")}).on("change","#plaintext",function(){var aq=Q(this).is(":checked");b.prop("disabled",aq)[aq?"addClass":"removeClass"]("disabled")})}else{if(typeof autosavePeriodical!="undefined"){autosavePeriodical.repeat=false}Q("#mailster_details").on("click","#show_recipients",function(){var at=Q(this),ar=Q("#recipients-list"),aq=Q("#recipients-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css("display","inline");R("get_recipients",{id:W},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100)},function(au,aw,av){aq.hide()});return false}).on("click","#show_clicks",function(){var at=Q(this),ar=Q("#clicks-list"),aq=Q("#clicks-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css("display","inline");R("get_clicks",{id:W},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100)},function(au,aw,av){aq.hide()});return false}).on("click","#show_environment",function(){var at=Q(this),ar=Q("#environment-list"),aq=Q("#environment-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css("display","inline");R("get_environment",{id:W},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100)},function(au,aw,av){aq.hide()});return false}).on("click","#show_geolocation",function(){var at=Q(this),ar=Q("#geolocation-list"),aq=Q("#geolocation-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css("display","inline");R("get_geolocation",{id:W},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100,function(){var ay,az,aB={legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc","#2BB3E7"],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}},ax;var aD;google.load("visualization","1.0",{packages:["geochart","corechart"],callback:function(){aD=new google.visualization.GeoChart(document.getElementById("countries_map"));ay=az=google.visualization.arrayToDataTable(au.countrydata);if(location.hash&&(ax=location.hash.match(/region=([A-Z]{2})/))){av(ax[1])}else{aC()}google.visualization.events.addListener(aD,"regionClick",av)}});Q("a.zoomout").on("click",function(){aw();return false});Q("#countries_table").find("tbody").find("tr").on("click",function(){var aE=Q(this).data("code");(aE=="unknown"||!aE)?aw():av(aE);return false});function aw(){var aE={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9","#2BB3E7"]};ay=az;aC(aE);Q("#countries_table").find("tr").removeClass("wp-ui-highlight");Q("#mapinfo").hide();location.hash="#region="}function av(aF){var aE={},aG=aF.region?aF.region:aF,aH;if(aG.match(/-/)){return false}aE.region=aG;(au.unknown_cities[aG])?Q("#mapinfo").show().html("+ "+au.unknown_cities[aG]+" unknown locations"):Q("#mapinfo").hide();aH=au.geodata[aG]?au.geodata[aG]:[];aE.resolution="provinces";aE.displayMode="markers";aE.dataMode="markers";aE.colors=["#4EBEE9","#2BB3E7"];ay=new google.visualization.DataTable();ay.addColumn("number","Lat");ay.addColumn("number","Long");ay.addColumn("string","tooltip");ay.addColumn("number","Value");ay.addColumn({type:"string",role:"tooltip"});ay.addRows(aH);Q("#countries_table").find("tr").removeClass("wp-ui-highlight");Q("#country-row-"+aG).addClass("wp-ui-highlight");location.hash="#region="+aG;aC(aE)}function aC(aE){aE=Q.extend(aB,aE);aD.draw(ay,aE);Q("a.zoomout").css({visibility:(aB.region!="world"?"visible":"hidden")})}function aA(aF){var aE=aF;Q.each(regions,function(aG,aH){if(Q.inArray(aF,aH)!=-1){aE=aG}});return aE}})},function(au,aw,av){aq.hide()});return false}).on("click","#show_errors",function(){var at=Q(this),ar=Q("#error-list"),aq=Q("#error-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css("display","inline");R("get_errors",{id:W},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100)},function(au,aw,av){aq.hide()});return false}).on("click","#show_countries",function(){Q("#countries_wrap").toggle();return false});Q("#mailster_details").on("click",".load-more-receivers",function(){var aw=Q(this),av=aw.data("page"),at=aw.data("types"),au=aw.data("orderby"),ar=aw.data("order"),aq=aw.next().css({display:"inline"});R("get_recipients_page",{id:W,types:at,page:av,orderby:au,order:ar},function(ax){aq.hide();if(ax.success){aw.parent().parent().replaceWith(ax.html)}},function(ax,az,ay){detailbox.removeClass("loading")});return false}).on("click",".recipients-limit",function(aq){if(aq.altKey){Q("input.recipients-limit").prop("checked",false);Q(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(au){var aw=Q("#recipients-list"),ar=Q("#recipients-ajax-loading"),at=Q("input.recipients-limit:checked").map(function(){return this.value}).get(),av=Q("select.recipients-order").val(),aq=Q("a.recipients-order").hasClass("asc")?"ASC":"DESC";ar.css({display:"inline"});Q("input.recipients-limit").prop("disabled",true);R("get_recipients",{id:W,types:at.join(","),orderby:av,order:aq},function(ax){ar.hide();Q("input.recipients-limit").prop("disabled",false);aw.html(ax.html).slideDown(100)},function(ax,az,ay){ar.hide()});return false}).on("click","a.recipients-order",function(){Q(this).toggleClass("asc");Q("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var aq=Q(this),at=aq.data("id"),ar=Q("#receiver-detail-"+at).show();aq.parent().addClass("loading").parent().addClass("expanded");R("get_recipient_detail",{id:at,campaignid:W},function(au){aq.parent().removeClass("loading");if(au.success){ar.find("div.receiver-detail-body").html(au.html).slideDown(100)}},function(au,aw,av){ar.removeClass("loading")});return false}).on("click","#stats label",function(){Q("#recipients-list").find("input").prop("checked",false).filter("input."+Q(this).attr("class")).prop("checked",true).trigger("change")});B.on("mouseenter","a.clickbadge",function(){var aw=Q(this),aq=aw.position(),av=aw.data("p"),au=aw.data("link"),ar=aw.data("clicks"),at=aw.data("total");c.find(".piechart").data("easyPieChart").update(av);c.find(".link").html(au);c.find(".clicks").html(ar);c.find(".total").html(at);c.stop().fadeIn(100).css({top:aq.top-85,left:aq.left-(c.width()/2-aw.width()/2)})}).on("mouseleave","a.clickbadge",function(){c.stop().fadeOut(400)});Q("#mailster_receivers").on("click",".create-new-list",function(){var aq=Q(this).hide();Q(".create-new-list-wrap").slideDown();Q(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var au=Q(this),at=Q(".create-list-type"),ar="",aq=Q(".mailster-total");if(at.val()==-1){return false}if(ar=prompt(mailsterL10n.enter_list_name,w(mailsterL10n.create_list,at.find(":selected").text(),Q("#title").val()))){aq.addClass("loading");R("create_list",{name:ar,listtype:at.val(),id:W},function(av){aq.removeClass("loading");var aw=Q('<div class="'+((!av.success)?"error":"updated")+'"><p>'+av.msg+"</p></div>").hide().prependTo(Q(".create-new-list-wrap")).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aw.remove()})},function(av,ax,aw){aq.removeClass("loading")})}return false}).on("change",".create-list-type",function(){var ar=Q(this),aq=Q(".mailster-total");if(ar.val()==-1){return false}ar.prop("disabled",true);aq.addClass("loading");R("get_create_list_count",{listtype:ar.val(),id:W},function(at){ar.prop("disabled",false);aq.removeClass("loading").html(at.count)},function(at,av,au){ar.prop("disabled",false);aq.removeClass("loading").html("")})}).on("click",".mailster-total",function(){Q(".create-list-type").trigger("change")});Q(".piechart").easyPieChart({animate:2000,rotate:180,barColor:"#2BB3E7",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(aq){this.$el.find("span").text(Math.round(aq))},onStop:function(aq){this.$el.find("span").text(Math.round(aq))}});j.on("heartbeat-send",function(ar,aq){if(aq.wp_autosave){delete aq.wp_autosave}aq.mailster={page:"edit",id:W}}).on("heartbeat-tick",function(ax,av){if(!av.mailster[W]){return}var at=av.mailster[W],ar=Q("#stats").find(".verybold"),au=Q("#stats").find(".piechart"),aq=Q(".progress"),aw=(at.sent/at.total*100);Q(".hb-sent").html(at.sent_f);Q(".hb-opens").html(at.opens_f);Q(".hb-clicks").html(at.clicks_f);Q(".hb-clicks_total").html(at.clicks_total_f);Q(".hb-unsubs").html(at.unsubs_f);Q(".hb-bounces").html(at.bounces_f);Q(".hb-geo_location").html(at.geo_location);Q.each(at.environment,function(ay){Q(".hb-"+ay).html((this.percentage*100).toFixed(2)+"%")});if(Q("#stats_opens").length){Q("#stats_opens").data("easyPieChart").update(Math.round(at.open_rate))}if(Q("#stats_clicks").length){Q("#stats_clicks").data("easyPieChart").update(Math.round(at.click_rate))}if(Q("#stats_unsubscribes").length){Q("#stats_unsubscribes").data("easyPieChart").update(Math.round(at.unsub_rate))}if(Q("#stats_bounces").length){Q("#stats_bounces").data("easyPieChart").update(Math.round(at.bounce_rate))}aq.find(".bar").width(aw+"%");aq.find("span").eq(1).html(at.sent_formatted);aq.find("var").html(Math.round(aw)+"%");e(at.clickbadges);if(at.status!=Q("#original_post_status").val()&&!Q("#mailster_status_changed_info").length){Q('<div id="mailster_status_changed_info" class="error inline"><p>'+w(mailsterL10n.statuschanged,'<a href="post.php?post='+W+'&action=edit">'+mailsterL10n.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});wp.heartbeat.interval("fast")}}var ah=function(){var au=B.offset();function aF(){x.on("click","a.template",aD).on("click","a.save-template",aB).on("click","a.clear-modules",ax).on("click","a.preview",az).on("click","a.undo",aE).on("click","a.redo",aA).on("click","a.code",av).on("click","a.plaintext",aw).on("click","a.dfw",aq).on("click","a.file",ar);G.on("click","button.save-template",aC).on("click","button.save-template-cancel",tb_remove);ae.on("scroll.optionbar",function(){var aG=ae.scrollTop();if(aG<au.top-50||aG>au.top+B.height()-120){if(/fixed-optionbar/.test(G[0].className)){G.removeClass("fixed-optionbar")}x.width("auto")}else{if(!/fixed-optionbar/.test(G[0].className)){G.addClass("fixed-optionbar")}x.width(B.width())}}).on("resize.optionbar",function(){au=B.offset();ae.trigger("scroll.optionbar")})}function aB(){tb_show(mailsterL10n.save_template,"#TB_inline?x=1&width=480&height=320&inlineId=mailster_template_save",null);Q("#new_template_name").focus().select();return false}function aC(){a("disable");var aJ=Q("#new_template_name").val();if(!aJ){return false}a("save");var aG=Q("#new_template-ajax-loading").css("display","inline"),aI=Q("#new_template_modules").is(":checked"),aM=Q("#new_template_active_modules").is(":checked"),aK=Q("#new_template_saveas_dropdown").val(),aH=!!parseInt(Q('input[name="new_template_overwrite"]:checked').val(),10),aL=i();R("create_new_template",{name:aJ,modules:aI,activemodules:aM,overwrite:aH?aK:false,template:Q("#mailster_template_name").val(),content:aL,head:t.val()},function(aN){aG.hide();if(aN.success){if(window.wp){window.wp=null}window.location=aN.url}else{alert(aN.msg)}},function(aN,aP,aO){aG.hide()});return false}function aE(){if(an){an--;T(I[an],100,false);X.val(I[an]);a("refresh");x.find("a.redo").removeClass("disabled");if(!an){Q(this).addClass("disabled")}}return false}function aA(){var aG=I.length;if(an<aG-1){an++;T(I[an],100,false);X.val(I[an]);a("refresh");x.find("a.undo").removeClass("disabled");if(an>=aG-1){Q(this).addClass("disabled")}}return false}function ax(){if(confirm(mailsterL10n.remove_all_modules)){var aG=C.contents().find("module");var aH=C.contents().find("modules");aH.slideUp(function(){aG.remove();aH.html("").show();a("refresh");a("save")})}return false}function az(){a("save");var aK=Q(this),aI=i(),aH=N.val(),aG=aa.val(),aJ=V.val();if(x.find("a.preview").is(".loading")){return false}x.find("a.preview").addClass("loading");R("set_preview",{id:W,content:aI,head:t.val(),issue:Q("#mailster_autoresponder_issue").val(),subject:aH,preheader:aG},function(aL){x.find("a.preview").removeClass("loading");Q(".mailster-preview-iframe").attr("src",ajaxurl+"?action=mailster_get_preview&hash="+aL.hash+"&_wpnonce="+aL.nonce);tb_show((aJ?w(mailsterL10n.preview_for,'"'+aJ+'"'):mailsterL10n.preview),"#TB_inline?hash="+aL.hash+"&_wpnonce="+aL.nonce+"&width="+(Math.min(1200,ae.width()-50))+"&height="+(ae.height()-100)+"&inlineId=mailster_campaign_preview",null)},function(aL,aN,aM){x.find("a.preview").removeClass("loading")})}function ay(){x.remove()}function at(){Q("#new_template_name").on("focus",function(){j.unbind("keypress.mailster").bind("keypress.mailster",function(aG){if(aG.keyCode==13){aC();return false}})}).select().focus().on("blur",function(){j.unbind("keypress.mailster")})}function aD(aG){var aH=Q(this);aH.parent().find("ul").eq(0).slideToggle(100);return false}function av(){var aH=!C.is(":visible");var aG;if(!aH){aG=n(A());x.find("a.code").addClass("loading");a("disable");R("toggle_codeview",{bodyattributes:aG.parts[2],content:aG.content,head:aG.head},function(aI){x.find("a.code").addClass("active").removeClass("loading");M.hide();X.val(aI.content);x.find("a").not("a.redo, a.undo, a.code").addClass("disabled");O=CodeMirror.fromTextArea(X.get(0),D)},function(aI,aK,aJ){x.find("a.code").addClass("active").removeClass("loading");a("enable")})}else{aG=n(O.getValue());O.clearHistory();x.find("a.code").addClass("loading");a("disable");R("toggle_codeview",{bodyattributes:aG.parts[2],content:aG.content,head:aG.head},function(aI){T(aI.content,100,true);M.show();X.hide();Q(".CodeMirror").remove();x.find("a.code").removeClass("active").removeClass("loading");x.find("a").not("a.redo, a.undo, a.code").removeClass("disabled");a("enable");a("refresh")},function(aI,aK,aJ){x.find("a.code").addClass("active").removeClass("loading");a("enable")})}return false}function aw(){var aG=!C.is(":visible");if(!aG){x.find("a.plaintext").addClass("active");M.hide();b.show();ad.show();x.find("a").not("a.redo, a.undo, a.plaintext, a.preview").addClass("disabled")}else{M.show();ad.hide();x.find("a.plaintext").removeClass("active");x.find("a").not("a.redo, a.undo, a.plaintext, a.preview").removeClass("disabled");a("refresh")}return false}function aq(aG){if(aG.type=="mouseout"&&!/DIV|H3/.test(aG.target.nodeName)){return}au=B.offset();if(!G.hasClass("focus-on")){G.removeClass("focus-off").addClass("focus-on");Q("#wpbody").on("mouseleave.dfw",aq);x.find("a.dfw").addClass("active");if(ae.scrollTop()<au.top){d(au.top-80)}}else{G.removeClass("focus-on").addClass("focus-off");Q("#wpbody").off("mouseleave",aq);x.find("a.dfw").removeClass("active")}return false}function ar(aG){window.onbeforeunload=null}aF();return{hide:function(){ay()}}};var ap=function(){var bh=Q("#editbar"),aQ,a8={img:0,single:80,multi:0,btn:0,auto:0,codeview:0},a7=bh.find(".imagepreview"),aL=bh.find(".imagewidth"),aH=bh.find(".imageheight"),au=bh.find(".imagecrop"),bp=bh.find(".factor"),a9=bh.find(".highdpi"),aF=bh.find(".imagelink"),bs=bh.find(".imageurl"),bv=bh.find(".orgimageurl"),ax=bh.find(".imagealt"),ba=bh.find(".singlelink"),br=bh.find(".buttonlink"),aV=bh.find(".buttonlabel"),aE=bh.find(".buttonalt"),aK=bh.find(".button-nav"),bu=bh.find("ul.buttons"),bc,aR,bj,bm,aw,bi,aJ,aA,aU,aD,aB,aC="x",at="",aq=Q("#wp-mailster-editor-wrap"),bf=Q("#post-search"),av=Q("#image-search");function bo(){bh.on("keyup change","input.live",ar).on("keyup change","#mailster-editor",ar).on("click",".replace-image",a4).on("change",".highdpi",aZ).on("click","button.save",aP).on("click",".cancel",az).on("click","a.remove",aX).on("click","a.reload",bl).on("click","a.single-link-content",aT).on("click","a.add_image",a3).on("click","a.add_image_url",aI).on("click",".imagelist li",aN).on("dblclick",".imagelist li",aP).on("change","#post_type_select input",bl).on("click",".postlist li",be).on("click",".load-more-posts",bk).on("click","a.btnsrc",bt).on("click",".imagepreview",aO).on("click","a.nav-tab",aG).on("change","select.check-for-posts",a0).on("keyup change","#rss_url",bl).on("keyup change","#post-search",a6).on("keyup change","#image-search",a6).on("click","#rss_url",function(){Q(this).focus().select()}).on("click",".rss_change",ay).on("click","#recent_feeds a",bd).on("mouseenter","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",aY).on("mouseleave","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",bn);al(C.contents().find("img").eq(0),function(bx,by,bz){var bw=bz>=1.5;bp.val(bz);a9.prop("checked",bw);(bw)?bh.addClass("high-dpi"):bh.removeClass("high-dpi")});aK.on("click","a",function(){Q(this).parent().find("a").removeClass("nav-tab-active");Q(this).parent().parent().find("ul.buttons").hide();var bw=Q(this).addClass("nav-tab-active").attr("href");Q("#tab-"+bw.substr(1)).show();return false});bs.on("paste change",function(bx){var bw=Q(this);setTimeout(function(){var bz=a5(bw.val()),by=new Image();if(bz){aS();by.onload=function(){a7.attr("src",bz);aH.val(Math.round(by.width/(by.width/by.height)));bj={width:by.width,height:by.height,asp:by.width/by.height};aS(false)};by.onerror=function(){if(bx.type!="paste"){alert(w(mailsterL10n.invalid_image,'"'+bz+'"'))}};by.src=bz}},1)});aL.on("change, keyup",function(){if(!au.is(":checked")){aH.val(Math.round(aL.val()/bj.asp))}aM()});aH.on("change, keyup",function(){if(!au.is(":checked")){aL.val(Math.round(aH.val()*bj.asp))}aM()});au.on("change",function(){if(!au.is(":checked")){aH.val(Math.round(aL.val()/bj.asp));au.parent().removeClass("not-cropped")}else{au.parent().addClass("not-cropped")}aM()});Q("#dynamic_embed_options_post_type").on("change",function(){var bw=Q("#dynamic_embed_options_cats");bw.find("select").prop("disabled",true);aS();R("get_post_term_dropdown",{posttype:Q(this).val()},function(bx){aS(false);if(bx.success){bw.html(bx.html);if(aw&&aw.terms){var by=bw.find(".dynamic_embed_options_taxonomy_wrap");Q.each(aw.terms,function(bA,bz){if(!bz){return}var bB=bz.split(",");Q.each(bB,function(bD,bF){var bC=by.eq(bA).find("select").eq(bD),bE;if(!bC.length){bE=by.eq(bA).find("select").last();bC=bE.clone();bC.insertAfter(bE);Q("<span> "+mailsterL10n.or+" </span>").insertBefore(bC)}bC.val(bF)})})}}a0()},function(bx,bz,by){aS(false)})});bh.on("keypress.mailster",function(bw){if(bw.keyCode==13&&bw.target.nodeName.toLowerCase()!="textarea"){return false}}).on("keyup.mailster",function(bw){switch(bw.keyCode){case 27:az();return false;break;case 13:if(aR.type!="multi"&&aR.type!="codeview"){aP();return false}break}});bh.find(".current-tag").on("click","a",function(){return false});if(bh.draggable){bh.draggable({distance:20,axis:"y"})}if(o&&tinymce.get("mailster-editor")){if(tinymce.majorVersion>=4){tinymce.get("mailster-editor").on("keyup",function(){a2(this)});tinymce.get("mailster-editor").on("ExecCommand",function(){a2(this)})}else{tinymce.get("mailster-editor").onKeyUp.add(function(){a2(this)});tinymce.get("mailster-editor").onExecCommand.add(function(){a2(this)})}}}function bq(bw){if(bh.draggable){if(bw!==false){bh.draggable("enable")}else{bh.draggable("disable")}}}function aY(){bq(false)}function bn(){bq(true)}function aG(by,bw){var bx;if(typeof by=="string"){bx=aQ.find('a[href="'+by+'"]')}else{bx=Q(this);by=bx.attr("href")}bx.parent().find("a.nav-tab").removeClass("nav-tab-active");bx.addClass("nav-tab-active");aQ.find(".tab").hide();aQ.find(by).show();if(by=="#dynamic_embed_options"&&bw!==false){Q("#dynamic_embed_options_post_type").trigger("change")}if(by=="#image_button"){bc="image"}if(by=="#text_button"){bc="text"}aJ=aQ.find(by).find(".postlist").eq(0);return false}function a4(){aS();var bz=bp.val(),bw=aR.element.width(),by=Math.round(bw/1.6),bx=Q("<img>",{src:"https://dummy.newsletter-plugin.com/"+(bw*bz)+"x"+(by*bz)+".jpg",alt:aR.content,label:aR.content,width:bw,height:by,border:0,editable:aR.content});bx[0].onload=function(){bx.attr({width:bw,height:by}).removeAttr("style");bg()};if(aR.element.parent().is("a")){aR.element.unwrap()}if(!aR.element.parent().is("td")){aR.element.unwrap()}aR.element.replaceWith(bx);return false}function aZ(){if(Q(this).is(":checked")){bp.val(2);bh.addClass("high-dpi")}else{bp.val(1);bh.removeClass("high-dpi")}}function a0(){clearInterval(aU);aS();Q("#dynamic_embed_options").find("h4.current-match").html("&hellip;");Q("#dynamic_embed_options").find("div.current-tag").html("&hellip;");aU=setTimeout(function(){var bA=bh.find("#dynamic_embed_options_post_type").val(),bx=bh.find("#dynamic_embed_options_content").val(),bz=bh.find("#dynamic_embed_options_relative").val(),by=bh.find(".dynamic_embed_options_taxonomy_wrap"),bw=[];Q.each(by,function(bD){var bC=Q(this).find("select"),bB=[];Q.each(bC,function(){var bE=parseInt(Q(this).val(),10);if(bE!=-1&&Q.inArray(bE,bB)==-1&&!isNaN(bE)){bB.push(bE)}});bB=bB.join(",");if(bB){bw[bD]=bB}});R("check_for_posts",{id:W,post_type:bA,relative:bz,extra:bw,modulename:aR.name,expect:aR.elements.expects},function(bB){aS(false);if(bB.success){bm=bB.pattern;Q("#dynamic_embed_options").find("h4.current-match").html(bB.title);Q("#dynamic_embed_options").find("div.current-tag").text(bB.pattern.title+"\n\n"+bB.pattern[bx])}},function(bB,bD,bC){aS(false)})},500)}function a5(bz,bw,bx,bA){bw=bw||aL.val();bx=bx||aH.val()||Math.round(bw/1.6);bA=typeof bA=="undefined"?au.prop(":checked"):bA;if(/^\{([a-z0-9-_,;:|]+)\}$/.test(bz)){var by=bp.val();bz=mailsterdata.ajaxurl+"?action=mailster_image_placeholder&tag="+bz.replace("{","").replace("}","")+"&w="+Math.abs(bw)+"&h="+Math.abs(bx)+"&c="+(bA?1:0)+"&f="+by}return bz}function a1(bx){if(-1!==bx.indexOf("?action=mailster_image_placeholder&tag=")){var bw=bx.match(/&tag=([a-z0-9-_,;:|]+)&/);return"{"+bw[1]+"}"}return false}function ar(bw){if((bw.keyCode||bw.which)!=27&&aR){aR.element.html(Q(this).val())}}function aS(bw){if(bw===false){Q("#editbar-ajax-loading").hide();bh.find(".buttons").find("button").prop("disabled",false)}else{Q("#editbar-ajax-loading").css("display","inline");bh.find(".buttons").find("button").prop("disabled",true)}}function aP(){if(aR.type=="img"){var bM=aR.element.is("img");if(bs.val()){bj={id:null,name:"",src:a5(bs.val()),width:bj.width,height:bj.height,asp:bj.width/bj.height}}if(bj){aS();var bF=bp.val()||1,by=bM?"src":"background";aR.element.attr({"data-id":bj.id}).data("id",bj.id).addClass("mailster-loading");if(bM){aR.element.attr({src:bj.src,width:Math.round(aL.val()),height:Math.round(aH.val()),alt:bj.name});if(au.is(":checked")){aR.element.attr({"data-crop":true}).data("crop",true)}}if(bj.src){aR.element.attr(by,bj.src);aR.element[0].style.cssText=aR.element[0].style.cssText.replace(/url\("?(.+)"?\)/,"url("+bj.src+")")}R("create_image",{id:bj.id,src:bj.src,width:aL.val()*bF,height:aH.val()*bF,crop:au.is(":checked")},function(bN){aS(false);if(bN.success){a7.attr("src",bN.image.url);bN.image.width=(bN.image.width||bj.width)/bF;bN.image.height=bN.image.width/(bj.asp);bN.image.asp=bj.asp;bj=bN.image;bj.name=ax.val();if(bM){aR.element.one("load error",function(bR){if("error"==bR.type){alert(w(mailsterL10n.invalid_image,bN.image.url))}aR.element.removeClass("mailster-loading");a("save")});aR.element.attr({width:Math.round(aL.val()),height:Math.round(aH.val()),alt:bj.name});if(au.is(":checked")){aR.element.attr({"data-crop":true}).data("crop",true)}}else{aR.element.removeClass("mailster-loading");var bO=aR.element.html(),bQ=bO.match(/<modules/),bP;if(bv.val()){if(bQ){if(bQ=bO.match(new RegExp("<v:background(.*)</v:background>","s"))){aR.element.html(am(bO,bQ[0],am(bQ[0],bv.val(),bj.url)))}}else{aR.element.html(am(bO,bv.val(),bj.url));aR.element.find("single, multi").removeAttr("id")}}}aR.element.removeAttr(by).attr(by,bj.url)}else{aR.element.removeClass("mailster-loading")}ax.val("");bg()},function(bN,bP,bO){aS(false)})}else{aR.element.attr({alt:ax.val()});bg()}if(aR.element.parent().is("a")){aR.element.unwrap()}var bJ=aF.val();if(bJ){aR.element.wrap('<a href="'+bJ+'"></a>')}return false}else{if(aR.type=="btn"){var bJ=br.val();if(!bJ&&!confirm(mailsterL10n.remove_btn)){return false}var bz=aQ.find("a.active").find("img").attr("src");if(typeof bz=="undefined"){bc="text";if(!aV.val()){aV.val(mailsterL10n.read_more)}}if("image"==bc){var bF=bp.val();var bB=new Image();bB.onload=function(){if(!aR.element.find("img").length){var bO=aR.element.closest(".textbutton");var bN=Q('<a href="" editable label="'+aR.name+'"><img></a>');(bO.length)?bO.replaceWith(bN):aR.element.replaceWith(bN);aR.element=bN}aR.element.find("img").attr({src:bz,width:Math.round((bB.width||aR.element.width())/bF),height:Math.round((bB.height||aR.element.height())/bF),alt:aE.val()});(bJ)?aR.element.attr("href",bJ):aR.element.remove();bg()};bB.src=bz}else{var bx=aR.element.closest(".textbutton"),bK=aV.val();if(!bx.length){aR.element.replaceWith('<table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bJ+'" editable label="'+bK+'">'+bK+"</a></td></tr></table>")}else{if(aR.element[0]==bx[0]){aR.element=bx.find("a")}aR.element.text(bK)}if(bJ){aR.element.attr("href",bJ)}else{aR.element.remove();bx.remove()}bg()}return false}else{if(aR.type=="auto"){var bE=Q("#embedoption-bar").find(".nav-tab-active").data("type");if("dynamic"==bE){var bD=bh.find("#dynamic_embed_options_content").val();bm.content=bm[bD];aR.element.attr("data-tag",bm.tag).data("tag",bm.tag)}else{if("rss"==bE){var bD=Q(".embed_options_content_rss:checked").val();aR.element.removeAttr("data-tag").removeData("tag").attr("data-rss",Q("#rss_url").val())}else{var bD=Q(".embed_options_content:checked").val();aR.element.removeAttr("data-tag").removeData("tag")}}if(bm){if(bm.title){aR.elements.single.each(function(bN,bP){var bQ=Q(this),bO=bQ.attr("expect")||"title";if(!Q.isArray(bm[bO])){bm[bO]=[bm[bO]]}bQ.html(bm[bO].shift())})}if(bm.link){if(aR.elements.buttons.length){aR.elements.buttons.last().attr("href",bm.link);aR.elements.buttons.not(":last").remove()}else{aR.elements.multi.last().after('<buttons><table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bm.link+'" title="'+mailsterL10n.read_more+'" editable label="'+mailsterL10n.read_more+'">'+mailsterL10n.read_more+"</a></td></tr></table></buttons>")}}else{if(aR.elements.buttons.parent().length&&aR.elements.buttons.parent()[0].nodeName=="TD"){aR.elements.buttons.closest(".textbutton").remove()}else{if(aR.elements.buttons.length){if(aR.elements.buttons.last().find("img").length){aR.elements.buttons.remove()}}}}if(aR.elements.multi.length){var bH=aR.elements.multi.length,bL=bm[bD]?bm[bD]:"",bG=[],bw,bI;if(!Q.isArray(bL)){bw=bL.length,bI=("static"==bE)?Math.ceil(bw/bH):bw;for(var bA=0;bA<bH;bA++){bG.push(bL.substring(bA*bI,bA*bI+bI))}}else{bG=bL}aR.elements.multi.each(function(bN,bO){Q(this).html(bG[bN]?bG[bN]:"")})}if(bm.image&&aR.elements.images.length){if(!Q.isArray(bm.image)){bm.image=[bm.image]}aS();aR.elements.images.each(function(bO,bT){if(!bm.image[bO]){return}var bU=Q(this);var bS=bp.val();if("static"==bE){R("create_image",{id:bm.image[bO].id,width:bU.width()*bS,height:bU.height()*bS,crop:bU.data("crop")},function(bV){if(bV.success){aS(false);if("img"==bU.prop("tagName").toLowerCase()){bU.attr({"data-id":bm.image[bO].id,src:bV.image.url,width:Math.round(bV.image.width/bS),height:Math.round(bV.image.height/bS),alt:bm.alt||bm.title[bO]}).data("id",bm.image[bO].id);if(bU.parent().is("a")){bU.unwrap()}if(bm.link){bU.wrap("<a>");bU.parent().attr("href",bm.link)}}else{var bW=bU.attr("background");bU.attr({"data-id":bm.image[bO].id,background:bV.image.url}).data("id",bm.image[bO].id).css("background-image","");aR.element.html(am(aR.element.html(),bW,bV.image.url))}}bg()},function(bV,bX,bW){aS(false)});return false}else{if("dynamic"==bE||"rss"==bE){var bR=bU.width(),bQ=bU.data("crop"),bN=bQ?bU.height():null;if("img"==bU.prop("tagName").toLowerCase()){bU.removeAttr("height").removeAttr("data-id").attr({src:a5(bm.image[bO],bR,bN,bQ),width:bR,alt:bm.alt||bm.title[bO]}).removeData("id")}else{var bP=bU.attr("background");bU.removeAttr("data-id").attr({background:a5(bm.image[bO],bR)}).removeData("id").css("background-image","");aR.element.html(am(aR.element.html(),bP,a5(bm.image[bO],bR,bN,bQ)))}}}})}C.contents().find("html").find("img").each(function(){this.onload=function(){a("refresh")}})}}else{if(aR.type=="multi"){if(o&&tinymce.get("mailster-editor")&&!tinymce.get("mailster-editor").isHidden()){var bG=tinymce.get("mailster-editor").getContent();bG=bG.replace('href="http://{','href="{');aR.element.html(bG)}}else{if(aR.type=="single"){if(aR.conditions){aR.aa="<if";Q.each(Q(".conditinal-area"),function(){aR.aa=""})}if(aR.element.parent().is("a")){aR.element.unwrap()}var bJ=ba.val();if(bJ){aR.element.wrap('<a href="'+bJ+'"></a>')}}else{if(aR.type=="codeview"){var bC=O.getValue();aR.element.html(bC);aR.modulebuttons.prependTo(aR.element)}}}}}}bg();return false}function aX(){if(aR.element.parent().is("a")){aR.element.unwrap()}if("btn"==aR.type){var bw=aR.element.closest(".textbutton");if(!bw.length){bw=aR.element}if(bw.parent().children().length>2){bw.remove()}else{bw.remove()}}else{if("img"==aR.type&&"img"!=aR.tag){aR.element.attr("background","")}else{aR.element.remove()}}bg();return false}function az(){switch(aR.type){case"img":case"btn":break;default:aR.element.html(aR.content)}bg();return false}function bt(){var by=Q(this),bw=by.data("link");aQ.find(".btnsrc").removeClass("active");by.addClass("active");aE.val(by.attr("title"));if(bw){var bx;br.val(bw);if((bx=(bw+"").indexOf("USERNAME",0))!=-1){br.focus();p(br[0],bx,bx+8)}}return false}function aO(){Q(this).toggleClass("zoom")}function aN(by,bx){var bB=bx||Q(this),bA=bB.data("id"),bw=bB.data("name"),bz=bB.data("src");if(!bA){return}bj={id:bA,name:bw,src:bz};aS();aQ.find("li.selected").removeClass("selected");bB.addClass("selected");if(aR.element.data("id")==bA){ax.val(aR.element.attr("alt"))}else{if(aR.element.attr("alt")!=bw){ax.val(bw)}}bs.val("");a7.attr("src","").on("load",function(){a7.off("load");aR.width=a7.width();aR.height=a7.height();aR.asp=bB.data("asp")||(aR.width/aR.height);bj.asp=aR.asp;aS(false);if(!au.is(":checked")){aH.val(Math.round(aL.val()/aR.asp))}aM()}).attr("src",bz);return bj}function aM(){var bw=Math.round(0.5*(aR.height-(aR.width*(aH.val()/aL.val()))));a7.css({clip:"rect("+(bw)+"px,"+(aR.width)+"px,"+(aR.height-bw)+"px,0px)","margin-top":(-1*bw)+"px"})}function be(){var bA=Q(this),bz=bA.data("id"),bw=bA.data("name"),bx=bA.data("link"),by=bA.data("thumbid");if(aR.type=="btn"){br.val(bx);aE.val(bw);aQ.find("li.selected").removeClass("selected");bA.addClass("selected")}else{if(aR.type=="single"){ba.val(bx);aQ.find("li.selected").removeClass("selected");bA.addClass("selected")}else{aS();R("get_post",{id:bz,expect:aR.elements.expects},function(bB){aS(false);aQ.find("li.selected").removeClass("selected");bA.addClass("selected");if(bB.success){bm=bB.pattern;aQ.find(".editbarinfo").html(mailsterL10n.curr_selected+": <span>"+bm.title+"</span>")}},function(bB,bD,bC){aS(false);aQ.find("li.selected").removeClass("selected")})}}return false}function aW(bR){aR=bR;var by=bR.element,bx=by.closest("module"),bJ=(bA!="img")?bR.offset.top:0,bS=bR.name||"",bA=bR.type,bL=Q.trim(by.html()),bM=by.find("if"),bE,bQ,bH,bC,bF=1;aQ=bh.find("div.type."+bA);bh.addClass("current-"+bA);aR.width=by.width();aR.height=by.height();aR.asp=aR.width/aR.height;aR.crop=by.data("crop")?by.data("crop"):false;aR.tag=by.prop("tagName").toLowerCase();aR.content=bL;aw=aR.element.data("tag");a("selectModule",bx);if(bM.length){bE={"if":null,elseif:[],"else":null,total:0};bE=[];bh.addClass("has-conditions");bQ=aQ.find(".conditinal-area");bH=bh.find(".conditions").eq(0);bH.clone().prependTo(bQ);Q.each(bM.find("elseif"),function(){var bU=Q(this),bT=bU.html();bE.push({el:bU,html:bT,field:bU.attr("field"),operator:bU.attr("operator"),value:bU.attr("value")});bU.detach();bQ.clone().val(bT).insertAfter(bQ)});Q.each(bM.find("else"),function(){var bU=Q(this),bT=bU.html();bE.push({el:bU,html:bT});bU.detach();bQ.clone().val(bT).insertAfter(bQ)});bE.unshift({el:bM,html:bM.html(),field:bM.attr("field"),operator:bM.attr("operator"),value:bM.attr("value")})}else{bh.removeClass("has-conditions")}aR.conditions=bE;if(bA=="img"){au.prop("checked",aR.crop).parent()[aR.crop?"addClass":"removeClass"]("not-cropped");bp.val(1);al(by,function(bT,bU,bV){var bU=bV>=1.5;bp.val(bV);a9.prop("checked",bU);(bU)?bh.addClass("high-dpi"):bh.removeClass("high-dpi");bF=bV})}else{if(bA=="btn"){if(by.find("img").length){Q("#button-type-bar").find("a").eq(1).trigger("click");var bB=by.find("img").attr("src");if(aK.length){var bw=bh.find("img[src='"+bB+"']");if(bw.length){bh.find("ul.buttons").hide();var bP=bw.parent().parent().parent();bh.find('a[href="#'+bP.attr("id").substr(4)+'"]').trigger("click")}else{Q.each(bh.find(".button-nav"),function(){Q(this).find(".nav-tab").eq(0).trigger("click")})}}aV.val(by.find("img").attr("alt"));al(by.find("img"),function(bT,bU,bV){var bU=bV>=1.5;bp.val(bV);a9.prop("checked",bU);(bU)?bh.addClass("high-dpi"):bh.removeClass("high-dpi");bF=bV})}else{Q("#button-type-bar").find("a").eq(0).trigger("click");aV.val(Q.trim(by.text())).focus().select();br.val(aR.element.attr("href"));bh.find("ul.buttons").hide()}}else{if(bA=="auto"){aG("#"+(aw?"dynamic":"static")+"_embed_options",true);if(aw){var bK=aw.substr(1,aw.length-2).split(":"),bz=bK[1].split(";"),bO=parseInt(bz.shift(),10),bD=bz.length?bz:null;aw={post_type:bK[0],relative:bO,terms:bD};Q("#dynamic_embed_options_post_type").val(aw.post_type).trigger("change");Q("#dynamic_embed_options_relative").val(aw.relative).trigger("change")}else{}}else{if(bA=="codeview"){var bI=aQ.find("textarea"),bN=by.clone();aR.modulebuttons=bN.find("modulebuttons");bN.find("modulebuttons, button").remove();bN.find("single, multi").removeAttr("contenteditable spellcheck id dir style class");var bG=Q.trim(bN.html().replace(/\u200c/g,"&zwnj;").replace(/\u200d/g,"&zwj;"));bI.show().html(bG)}}}}bC=B.offset().top+(aR.offset.top-(ae.height()/2)+(aR.height/2));bC=Math.max(B.offset().top-200,bC);d(bC,function(){bh.find("h4.editbar-title").html(bS);bh.find("div.type").hide();bh.find("div."+bA).show();var bX=j.scrollTop()+(ae.height()/2)-B.offset().top-(bh.height()/2);bh.css({top:bX});aS();if(bA=="single"){if(bE){Q.each(bE,function(b2,b3){var b1=aQ.find(".conditinal-area").eq(b2);b1.find("select.condition-fields").val(b3.field);b1.find("select.condition-operators").val(b3.operator);b1.find("input.condition-value").val(b3.value);b1.find("input.input").val(b3.html)})}else{var b0=bL.replace(/&amp;/g,"&");ba.val("");if(aR.element.parent().is("a")){var bU=aR.element.parent().attr("href");ba.val(bU!="#"?bU:"");aT()}else{if(aR.element.find("a").length){var bW=aR.element.find("a");if(b0==bW.text()){var bU=bW.attr("href");b0=bW.text();ba.val(bU!="#"?bU:"")}}}aQ.find("input").eq(0).val(Q.trim(b0))}}else{if(bA=="img"){var bT=parseInt(by[0].style.maxWidth,10)||by.parent().width()||by.width()||null;var bZ=parseInt(by[0].style.maxHeight,10)||by.parent().height()||by.height()||null;var bY=by.attr("src")||by.attr("background");var bV=a1(bY)||"";if(by.parent().is("a")){aF.val(by.parent().attr("href").replace("%7B","{").replace("%7D","}"))}else{aF.val("")}ax.val(by.attr("alt"));bs.val(bV);bv.val(bY);by.data("id",by.attr("data-id"));Q(".imageurl-popup").toggle(!!bV);a7.removeAttr("src").attr("src",bY);bi="attachment";aJ=aQ.find(".imagelist");bj={id:by.data("id"),src:bY,width:by.width()*bF,height:by.height()*bF};bj.asp=bj.width/bj.height;bl();aM()}else{if(bA=="btn"){aE.val(by.find("img").attr("alt"));if(by.attr("href")){br.val(by.attr("href").replace("%7B","{").replace("%7D","}"))}bi="link";aJ=aQ.find(".postlist").eq(0);bl();Q.each(aQ.find(".buttons img"),function(){var b1=Q(this);b1.css("background-color",by.css("background-color"));(b1.attr("src")==bB)?b1.parent().addClass("active"):b1.parent().removeClass("active")})}else{if(bA=="auto"){bi="post";aJ=aQ.find(".postlist").eq(0);bl();aR.elements={single:aR.element.find("single"),multi:aR.element.find("multi"),buttons:aR.element.find("a[editable]"),images:aR.element.find("img[editable], td[background], th[background]"),expects:aR.element.find("[expect]").map(function(){return Q(this).attr("expect")}).toArray()}}else{if(bA=="codeview"){if(O){O.clearHistory();O.setValue("");aQ.find(".CodeMirror").remove()}}}}}}bh.show(0,function(){if(bA=="single"){bh.find("input").focus().select()}else{if(bA=="img"){aL.val(aR.width);aH.val(aR.height);au.prop("checked",aR.crop)}else{if(bA=="btn"){aL.val(bT);aH.val(bZ)}else{if(bA=="multi"){Q("#mailster-editor").val(bL);if(o&&tinymce.get("mailster-editor")){tinymce.get("mailster-editor").setContent(bL);tinymce.execCommand("mceFocus",false,"mailster-editor")}}else{if(bA=="codeview"){O=CodeMirror.fromTextArea(bI.get(0),D)}}}}}});aS(false)},100)}function bl(bw,bz){var by=Q("#post_type_select").find("input:checked").serialize(),bx={type:bi,posttypes:by,search:at,offset:0};if(Q(this).is("#rss_url")){bx.type="_rss";bx.url=Q.trim(Q("#rss_url").val());if(bx.url==aC){return false}aC=bx.url;if(!bx.url){Q("#rss_more").slideUp(200);return false}Q(".rss_info").html("")}if(bi=="attachment"){bx.id=bj.id}aJ.empty();aS();R("get_post_list",bx,function(bA){aS(false);if(bA.success){aA=bA.itemcount;bb(bA.html,true);if(bA.rssinfo){Q("#rss_more").slideDown(200);Q("#rss_input").slideUp(200);Q(".rss_info").html("<h4>"+bA.rssinfo.title+" &ndash; "+bA.rssinfo.description+'</h4><p class="tiny">'+bA.rssinfo.copyright+"</p>")}bz&&bz()}},function(bA,bC,bB){aS(false)})}function bk(){var by=Q(this),bz=by.data("offset"),bw=by.data("type");aS();var bx=Q("#post_type_select").find("input:checked").serialize();R("get_post_list",{type:bw,posttypes:bx,search:at,offset:bz,url:Q.trim(Q("#rss_url").val()),itemcount:aA},function(bA){aS(false);if(bA.success){aA=bA.itemcount;by.parent().remove();bb(bA.html,false)}},function(bA,bC,bB){aS(false)});return false}function a6(){var bw=Q(this);clearTimeout(aD);aD=setTimeout(function(){var bx=bw.val();if(bx==at){return}at=bx;bl()},300)}function aT(){Q("#single-link").slideDown(200);ba.focus().select();bi="link";aJ=aQ.find(".postlist").eq(0);bl();return false}function bb(bx,bw,by){if(!by){by=aJ}if(bw){by.empty()}if(!by.html()){by.html("<ul></ul>")}by.find("ul").append(bx)}function bd(){Q("#rss_url").val(Q(this).attr("href")).trigger("change");return false}function ay(){Q("#rss_url").val("");Q("#rss_more").slideUp(200);Q("#rss_input").slideDown(200);return false}function aI(){Q(".imageurl-popup").toggle();if(!bs.val()&&bj.src.indexOf(location.origin)==-1&&bj.src.indexOf("dummy.newsletter-plugin.com")==-1){bs.val(bj.src)}bs.focus().select();return false}function a3(){if(!wp.media.frames.mailster_editbar){wp.media.frames.mailster_editbar=wp.media({title:mailsterL10n.select_image,library:{type:"image"},multiple:false});wp.media.frames.mailster_editbar.on("select",function(){var bx=wp.media.frames.mailster_editbar.state().get("selection").first().toJSON(),bw=Q("img").data({id:bx.id,name:bx.name,src:bx.url});bl(null,function(){aN(null,bw)})})}wp.media.frames.mailster_editbar.open()}function a2(bw){clearTimeout(ai);ai=setTimeout(function(){if(!bw){return}var bx=Q.trim(bw.save());aR.element.html(bx)},100)}function bg(){bh.removeClass("current-"+aR.type).hide();aS(false);Q("#single-link").hide();a("save");a("refresh");return false}bo();return{open:function(bw){aW(bw)},close:function(){bg()}}};var ao=function(){var ax=Q("#mailster_template"),aJ=Q("#module-selector"),az=Q("#module-search"),aL=aJ.find("li"),aI=Q("a.toggle-modules"),aE=C.contents().find("modules"),aC=C.contents().find("body"),aM=aE.find("module"),aF,au={},aH=!!parseInt(window.getUserSetting("mailstershowmodules",1),10);function aw(){var aP=aJ.data("current");ar(Q(this).data("id"),((aP&&aP.is("module"))?aP:false),true,true);return false}function aA(){var aP=Q(this).parent().parent().parent();aP.insertBefore(aP.prev("module"));a("refresh");a("save");return false}function aB(){var aP=Q(this).parent().parent().parent();aP.insertAfter(aP.next("module"));a("refresh");a("save");return false}function at(){var aP=Q(this).parent().parent().parent(),aQ=aP.clone().removeAttr("selected").hide();ar(aQ,aP,false,true);return false}function ay(){var aP=Q(this).parent().parent().parent();L.open({element:aP,name:aP.attr("label"),type:"auto",offset:aP.offset()});return false}function aD(){var aR=Q(this),aQ=aR.val(),aP=aR.parent().parent();if(!aQ){aQ=aR.attr("placeholder");aR.val(aQ)}aP.attr("label",aQ)}function aO(){var aP=Q(this).parent().parent().parent();aP.fadeTo(100,0,function(){aP.slideUp(100,function(){aP.remove();aM=C.contents().find("module");if(!aM.length){aE.html("")}a("refresh");a("save")})});return false}function ar(aQ,aR,aS,aP){var aU;if(au[aQ]){aU=au[aQ].el.clone()}else{if(aQ instanceof jQuery){aU=Q(aQ);aU.find("single, multi, buttons").removeAttr("contenteditable spellcheck id dir style class")}else{return false}}if(!aR&&!aE.length){return false}if(aR){(aS?aU.hide().insertBefore(aR):aU.hide().insertAfter(aR))}else{aU.hide().appendTo(aE)}aU.slideDown(100,function(){aU.css("display","block");a("resize");a("refresh");a("save")});if(aP){var aT=aU.offset().top+B.offset().top-(ae.height()/2)-aU.outerHeight();aT=Math.max(B.offset().top,aT);d(aT)}}function aq(){var aP=Q(this).parent().parent().parent();L.open({element:aP,name:aP.attr("label"),type:"codeview",offset:aP.offset()});return false}function aN(){Y.toggleClass("show-modules");aH=!aH;window.setUserSetting("mailstershowmodules",aH?1:0);setTimeout(function(){a("resize")},200)}function aG(){aL.hide();aJ.find("li:contains('"+Q(this).val()+"')").show()}function aK(){B.on("click","a.toggle-modules",aN).on("click","a.addmodule",aw);az.on("keyup",aG).on("focus",function(){az.select()});Q("#module-search-remove").on("click",function(){az.val("").trigger("keyup").focus();return false});av()}function av(){aM=C.contents().find("module");if(!aM.length){aE.html("")}aF=Q(ab.val()).add(aM);if(!aF.length){aJ.remove();return}aE=C.contents().find("modules");aE.on("click","a.up",aA).on("click","a.down",aB).on("click","a.auto",ay).on("click","a.duplicate",at).on("click","a.remove",aO).on("click","a.codeview",aq).on("change","input.modulelabel",aD);var aS="",aW="",aQ=0,aV=0;au=[];Q.each(aF,function(aZ){var a1=Q(this);if(a1.is("module")){var aY=a1.attr("label")||w(mailsterL10n.module,"#"+(++aV)),a0=mailsterdata.codeview?'<a class="mailster-btn codeview" title="'+mailsterL10n.codeview+'"></a>':"",a2=(a1.is("[auto]")?'<a class="mailster-btn auto" title="'+mailsterL10n.auto+'"></a>':"");Q("<modulebuttons><span>"+a2+'<a class="mailster-btn duplicate" title="'+mailsterL10n.duplicate_module+'"></a><a class="mailster-btn up" title="'+mailsterL10n.move_module_up+'"></a><a class="mailster-btn down" title="'+mailsterL10n.move_module_down+'"></a>'+a0+'<a class="mailster-btn remove" title="'+mailsterL10n.remove_module+'"></a></span><input class="modulelabel" type="text" value="'+aY+'" placeholder="'+aY+'" title="'+mailsterL10n.module_label+'" tabindex="-1"></modulebuttons>').prependTo(a1);if(!a1.parent().length){au.push({name:aY,el:a1})}}});var aR,aX,aU=Q("<dropzone></dropzone>"),aP=aU.clone(),aT=aU.add(aP);if(!Q._data(aJ[0],"events")){aJ.on("dragstart.mailster","li",function(aY){window.mailster_is_modulde_dragging=true;aY.originalEvent.dataTransfer.setData("Text",this.id);aC.addClass("drag-active");aX=Q(aY.target).data("id");aE.on("dragenter.mailster",function(aZ){var a0=Q(aZ.target).closest("module");if(!a0.length||aR&&aR[0]===a0[0]){return}aR=a0;aP.appendTo(aR);aU.prependTo(aR);setTimeout(function(){aP.addClass("visible");aU.addClass("visible");aM.removeClass("drag-up drag-down");a0.prevAll("module").addClass("drag-up");a0.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(aZ){aZ.preventDefault()}).on("drop.mailster",function(aZ){ar(aX,aM.length?(aR&&aR[0]===aE?false:aR):false,aU[0]===aZ.target,false,true);aM=C.contents().find("module");aZ.preventDefault()});aT.on("dragenter.mailster",function(aZ){Q(this).addClass("drag-over")}).on("dragleave.mailster",function(aZ){Q(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(aY){aR=null;aC.removeClass("drag-active");aT.removeClass("visible drag-over").remove();aM.removeClass("drag-up drag-down");aE.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");aT.off("dragenter.mailster").off("dragleave.mailster");window.mailster_is_modulde_dragging=false})}}aK();return{refresh:function(){av()}}};function d(at,ar,aq){at=Math.round(at);if(isNaN(aq)){aq=200}if(!k&&(af.scrollTop()==at||document.scrollingElement.scrollTop==at)){ar&&ar();return}af.stop().animate({scrollTop:at},aq,ar&&function(){ar()})}Q(window).on("Mailster:refresh",function(){clearTimeout(E);E=setTimeout(function(){a("resize");if(!f){v()}else{e()}},10)}).on("Mailster:resize",function(){var ar=0,aq=0;if(!H){return false}setTimeout(function(){if(!C[0].contentWindow.document.body){return}var at=C.contents().height()||C[0].contentWindow.document.body.offsetHeight||C.contents().find("html")[0].innerHeight||C.contents().find("html").height();C.attr("height",Math.max(500,at+(aq||0)))},ar?ar:500)}).on("Mailster:save",function(){if(!f&&H){var at=A();var ar=I.length,aq=I[ar-1];if(aq!=at){X.val(at);aa.prop("readonly",!at.match("{preheader}"));I=I.splice(0,an+1);I.push(at);if(ar>=mailsterL10n.undosteps){I.shift()}an=I.length-1;if(an){x.find("a.undo").removeClass("disabled")}x.find("a.redo").addClass("disabled");if(wp&&wp.autosave){wp.autosave.local.save()}}}}).on("Mailster:disable",function(){ak=true;Q(".button").prop("disabled",true);Q("input:visible").prop("disabled",true)}).on("Mailster:enable",function(){Q(".button").prop("disabled",false);Q("input:visible, input.wp-color-picker").prop("disabled",false);ak=false}).on("Mailster:selectModule",function(ar){if(!ar.detail){return}var aq=ar.detail[0]}).on("Mailster:updateCount",function(){clearTimeout(s);s=setTimeout(function(){var aA=[],az=[],av=Q("#list-checkboxes").find("input, select"),aw=Q("#list-checkboxes").find("input.list"),ar=Q("#list_extra"),au={},ay=Q(".mailster-total"),ax=Q("#mailster_conditions_render"),aq=Q(".mailster-conditions-wrap > .mailster-condition-group"),at=0;Q.each(aw,function(){var aB=Q(this).val();if(Q(this).is(":checked")){aA.push(aB)}});au.lists=aA;au.ignore_lists=Q("#ignore_lists").is(":checked");Q.each(aq,function(){var aB=Q(this).find(".mailster-condition");Q.each(aB,function(){var aF=Q(this),aD,aE=aF.find(".condition-field").val(),aC=aF.find(".mailster-conditions-operator-field.active").find(".condition-operator").val();if(!aC||!aE){return}aD=aF.find(".mailster-conditions-value-field.active").find(".condition-value").map(function(){return Q(this).val()}).toArray();if(aD.length==1){aD=aD[0]}if(!az[at]){az[at]=[]}az[at].push({field:aE,operator:aC,value:aD})});at++});au.operator=Q("select.mailster-list-operator").val();au.conditions=az;ay.addClass("loading");a("disable");R("get_totals",au,function(aB){a("enable");ay.removeClass("loading").html(aB.totalformatted);ax.html(aB.conditions)},function(aB,aD,aC){a("enable");ay.removeClass("loading").html("?")})},10)}).on("Mailster:xxx",function(){});function a(){var aq=arguments[0];var ar=arguments[1]||null;var at;if(k){at=document.createEvent("CustomEvent");at.initCustomEvent("Mailster:"+aq,false,false,{detail:ar})}else{at=new CustomEvent("Mailster:"+aq,{detail:ar})}window.dispatchEvent(at);C[0].contentWindow.window.dispatchEvent(at)}function v(){B.find(".content.mailster-btn").remove();var aq=C.contents().find("html"),ar=null;if(!aq){return}setTimeout(function(){if(!Q._data(aq[0],"events")){aq.off(".mailster").on("click.mailster","img[editable]",function(av){av.stopPropagation();var ay=Q(this),az=ay.offset(),ax=az.top+61,aw=az.left,at=ay.attr("label"),au="img";L.open({offset:az,type:au,name:at,element:ay})}).on("click.mailster","module td[background],module th[background]",function(at){at.stopPropagation();ar=true}).on("click.mailster","td[background], th[background]",function(av){av.stopPropagation();if(!ar&&av.target!=this){return}ar=null;var ay=Q(this),az=ay.offset(),ax=az.top+61,aw=az.left,at=ay.attr("label"),au="img";L.open({offset:az,type:au,name:at,element:ay})}).on("click.mailster","a[editable]",function(av){av.stopPropagation();av.preventDefault();var ay=Q(this),az=ay.offset(),ax=az.top+40,aw=az.left,at=ay.attr("label"),au="btn";L.open({offset:az,type:au,name:at,element:ay})})}if(!mailsterdata.inline){aq.on("click.mailster","multi, single",function(av){av.stopPropagation();var ay=Q(this),az=ay.offset(),ax=az.top+40,aw=az.left,at=ay.attr("label"),au=ay.prop("tagName").toLowerCase();L.open({offset:az,type:au,name:at,element:ay})})}},500)}function e(aq){B.find(".clickbadge").remove();var aq=aq||Q("#mailster_click_stats").data("stats"),ar=parseInt(aq.total,10);if(!ar){return}Q.each(aq.clicks,function(au,at){Q.each(at,function(ax,aB){var aA=C.contents().find('a[href="'+au.replace("&amp;","&")+'"]').eq(ax);if(aA.length){aA.css({display:"inline-block"});var aw=aA.offset(),az=aw.top,av=aw.left+5,aD=(aB.clicks/ar)*100,aC=(aD<1?"&lsaquo;1":Math.round(aD))+"%",ay=Q('<a class="clickbadge '+(aD<40?"clickbadge-outside":"")+'" data-p="'+aD+'" data-link="'+au+'" data-clicks="'+aB.clicks+'" data-total="'+aB.total+'"><span style="width:'+(Math.max(0,aD-2))+'%">'+(aD<40?"&nbsp;":aC)+"</span>"+(aD<40?" "+aC:"")+"</a>").css({top:az,left:av}).appendTo(B)}})})}function P(aw,av,at){if(!aw){aw=av}if(!av){return false}if(aw==av){return false}var ar=i(),au=new RegExp(aw,"gi"),aq=ab.val();if(at){at.data("value",av)}ab.val(aq.replace(au,av));Q("#mailster-color-"+aw.substr(1).toLowerCase()).attr("id","mailster-color-"+av.substr(1).toLowerCase());T(ar.replace(au,av),3000)}function am(at,aq,ar){if(aq===ar){return at}do{at=at.replace(aq,ar)}while(aq&&at.indexOf(aq)!==-1);return at}function K(ar){var at=i(),au=/\/img\/version(\d+)\//g,av="/img/"+ar+"/";html=at.replace(au,av);var aq=ab.val();ab.val(aq.replace(au,av));T(html);return}function A(){var aq=C[0].contentWindow.document.body,aw,au,av,ar,at="";if(typeof aq=="null"||!aq){return""}aw=Q("<div>"+aq.innerHTML+"</div>");aw.find(".mce-tinymce, .mce-widget, .mce-toolbar-grp, .mce-container, .screen-reader-text, .ui-helper-hidden-accessible, .wplink-autocomplete, modulebuttons, mailster, #mailster-editorimage-upload-button, button").remove();aw.find("#droplr-chrome-extension-is-installed").remove();aw.find("single, multi, module, modules, buttons").removeAttr("contenteditable spellcheck id dir style class selected");au=Q.trim(aw.html().replace(/\u200c/g,"&zwnj;").replace(/\u200d/g,"&zwj;"));av=aq.attributes||[];ar=av.length;if(ar){while(ar--){at=" "+av[ar].name+'="'+Q.trim(av[ar].value)+'"'+at}}at=Q.trim(at.replace(/(webkit |wp\-editor|mceContentBody|position: relative;|cursor: auto;|modal-open| spellcheck="(true|false)")/g,"").replace(/(class="(\s*)"|style="(\s*)")/g,""));return t.val()+"\n<body"+(at?" "+at:"")+">\n"+au+"\n</body>\n</html>"}function i(){return X.val()||A()}function n(aq){var ar=aq.match(/([^]*)<body([^>]*)?>([^]*)<\/body>([^]*)/m);return{parts:ar?ar:["","","","<multi>"+aq+"</multi>"],content:ar?ar[3]:"<multi>"+aq+"</multi>",head:ar?Q.trim(ar[1]):"",bodyattributes:ar?Q("<div"+(ar[2]||"")+"></div>")[0].attributes:""}}function T(ax,av,at){var ar=n(ax);var au=ar.bodyattributes.length,ay=(g||l)?C[0].contentWindow.document:r,aw=Q(ay).find("head").find("link"),aq=ay.getElementsByTagName("head")[0];t.val(ar.head);aq.innerHTML=ar.head.replace(/([^]*)<head([^>]*)?>([^]*)<\/head>([^]*)/m,"$3");Q(aq).append(aw);ay.body.innerHTML=ar.content;if(au){while(au--){ay.body.setAttribute(ar.bodyattributes[au].name,ar.bodyattributes[au].value)}}if(av!==false){clearTimeout(ai);ai=setTimeout(function(){J&&J.refresh&&J.refresh()},av||100)}if(typeof at=="undefined"||at===true){a("save")}}function S(){return V.val()+X.val()+b.val()+N.val()+aa.val()}function R(au,at,av,ar,aq){if(Q.isFunction(at)){if(Q.isFunction(av)){ar=av}av=at;at={}}aq=aq?aq:"JSON";Q.ajax({type:"POST",url:ajaxurl,data:Q.extend({action:"mailster_"+au,_wpnonce:F},at),success:function(ax,ay,aw){av&&av.call(this,ax,ay,aw)},error:function(ay,aB,aA){var aw=Q.trim(ay.responseText);if(aB=="error"&&!aA){return}if(console){console.error(aw)}if("JSON"==aq){var ax=aw.match(/{(.*)}$/);if(ax&&av){try{ax=Q.parseJSON(ax[0]);av.call(this,ax)}catch(az){if(console){console.error(az)}}return}}ar&&ar.call(this,ay,aB,aA);alert(aB+" "+ay.status+": "+aA+"\n\n"+mailsterL10n.check_console)},dataType:aq})}function u(aq){return Q.trim(aq).toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]*/g,"")}function ag(){var aF,aB,ax,ar,au,ay=new Date(),aq=Q(".time"),at=Q(".deliverytime").eq(0),aA=Q("#mailster_data_active"),aE=parseInt(aq.data("timestamp"),10)*1000,aD=false,av=aE-ay.getTime()+(ay.getTimezoneOffset()*60000);var aw=(aD)?1000:20000;function aC(){aF=new Date();ay=aF.getTime();aF.setTime(ay+av);ax=aF.getHours();ar=aF.getMinutes();if(!f&&aB&&ar!=aB[1]&&!aA.is(":checked")){at.val(az(ax)+":"+az(ar))}aB=[];aB.push(aF.getHours());aB.push(aF.getMinutes());if(aD){aB.push(aF.getSeconds())}au=aB.length;for(var aG=0;aG<au;aG++){aB[aG]=az(aB[aG])}aq.html(aB.join('<span class="blink">:</span>'));setTimeout(function(){aC()},aw)}function az(aG){if(aG<10){aG="0"+aG}return aG}aC()}function w(){var aq=Array.prototype.slice.call(arguments),av=aq.shift(),au=aq.length,at;for(var ar=0;ar<au;ar++){at=new RegExp("%("+(ar+1)+"\\$)?(s|d|f)");av=av.replace(at,aq[ar])}return av}function al(ar,au){ar=ar.eq(0);if(ar.is("img")&&ar.attr("src")){var at=new Image(),aq;at.onload=function(){aq=((at.width/ar.width()).toFixed(1)||1);if(au){au.call(this,at.width,at.height,isFinite(aq)?parseFloat(aq):1)}};at.src=ar.attr("src")}}function q(at,ar,aq,au){return(au===false?"":"#")+((1<<24)+(at<<16)+(ar<<8)+aq).toString(16).slice(1)}if(document.selection&&document.selection.createRange){p=function(ar,au,at){ar.focus();ar.select();var aq=document.selection.createRange();aq.collapse(true);aq.moveEnd("character",at);aq.moveStart("character",au);aq.select();return true}}else{p=function(aq,at,ar){aq.selectionStart=at;aq.selectionEnd=ar;return true}}if(window.getSelection){z=function(ar){var au="";if(document.activeElement&&(document.activeElement.tagName.toLowerCase()=="textarea"||document.activeElement.tagName.toLowerCase()=="input")){var at=document.activeElement.value;au=at.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var aq=window.getSelection();au=aq.toString()}return au}}else{z=function(ar){var at="";if(document.selection.createRange){var aq=document.selection.createRange();at=aq.text}return at}}window.tb_position=function(){if(!window.TB_WIDTH||!window.TB_HEIGHT){return}jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px",marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"})};aj()});